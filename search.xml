<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>常用Markdown语法</title>
    <url>/2020/05/29/%E5%B8%B8%E7%94%A8Markdown%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<p>这篇主要来记录我初步建立 markdown 文章一些基本操作。</p>
<h2 id="新建page"><a href="#新建page" class="headerlink" title="新建page"></a>新建page</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page-name</span><br></pre></td></tr></table></figure>


<h3 id="一、标题"><a href="#一、标题" class="headerlink" title="一、标题"></a>一、标题</h3><p>一级标题前面一个#，二级标题前面两个#，以此类推，总共到六级标题，#与文字之间一定要有空格。</p>
<h3 id="二、代码块"><a href="#二、代码块" class="headerlink" title="二、代码块"></a>二、代码块</h3><p>用前后 三个` 包裹着, ```后面写什么语言即展示怎样的高亮样式，例如：html、javascript</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="行内代码"><a href="#行内代码" class="headerlink" title="行内代码"></a>行内代码</h4><p>前后一个 ` 包裹，例：</p>
<p><code>行内代码</code></p>
<h3 id="三、引用"><a href="#三、引用" class="headerlink" title="三、引用"></a>三、引用</h3><p>使用 &gt; 表示引用， &gt;&gt; 表示引用里面再套一层引用，依次类推。</p>
<blockquote>
<p>‘&gt;’这是一级引用</p>
<blockquote>
<p>‘&gt;&gt;’这是二级引用</p>
<blockquote>
<p>‘&gt;&gt;&gt;’这是三级引用</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="四、链接"><a href="#四、链接" class="headerlink" title="四、链接"></a>四、链接</h3><p>使用 “ <a href="link"> </a> ” 表示行内链接。其中：</p>
<p>[] 内的内容为要添加链接的文字。</p>
<p>link 为链接地址。例如：<a href="https://www.baidu.com" target="_blank" rel="noopener">百度</a></p>
<blockquote>
<p><a href="https://www.baidu.com" target="_blank" rel="noopener">百度</a></p>
</blockquote>
<h3 id="五、导入图片"><a href="#五、导入图片" class="headerlink" title="五、导入图片"></a>五、导入图片</h3><p>使用 “ ![Alt text] (png) ” 导入图片。其中：</p>
<p>Alt text 为如果图片无法显示时显示的文字；<br>png 为图片所在路径；<br>本地引用是图片直接存储到本地通过相对路径引用，无需网络连接<br>上传图片将把图片上传至图床，这样在文档或图片移动时认可访问图片<br>示例：<br><img src="https://fech.in/static/images/cover/ml01-overview.jpeg" alt="图片无法显示时显示的文字"></p>
<h3 id="六、Todo-List"><a href="#六、Todo-List" class="headerlink" title="六、Todo List"></a>六、Todo List</h3><p>小写 x 表示已完成， 空格表示未完成</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 选中</li>
<li><input disabled="" type="checkbox"> 未选中<br>方法：<blockquote>
<p>-与[]之间须有空格 -[x] 例 1 -[ ] 例 2</p>
</blockquote>
</li>
</ul>
<h3 id="七、粗体，斜体，高亮和删除线"><a href="#七、粗体，斜体，高亮和删除线" class="headerlink" title="七、粗体，斜体，高亮和删除线"></a>七、粗体，斜体，高亮和删除线</h3><p>例如<strong>粗体</strong></p>
<blockquote>
<p>** 粗体示例 **</p>
</blockquote>
<p><em>斜体</em></p>
<blockquote>
<p>*斜体 *</p>
</blockquote>
<p><strong><em>粗加斜体</em></strong></p>
<blockquote>
<p><strong>* 粗加斜体 *</strong></p>
</blockquote>
<blockquote>
<p>==高亮==<br>部分编辑器不支持高亮</p>
</blockquote>
<p><del>删除线</del></p>
<blockquote>
<p><del>~ 删除线 ~</del></p>
</blockquote>
<h3 id="八、列表"><a href="#八、列表" class="headerlink" title="八、列表"></a>八、列表</h3><p>使用 1. 1. 1. 表示有序列表，使用 * 或 - 或 + 表示无序列表。</p>
<ol>
<li>列表一</li>
<li>列表二</li>
<li>列表三</li>
</ol>
<blockquote>
<p>1.列表一 1.列表二 1.列表三<br>记得 1. 与列表文字之间需要有空格</p>
</blockquote>
<ul>
<li>1 列表一<ul>
<li>2 列表二</li>
</ul>
</li>
</ul>
<blockquote>
<p>*1 列表一<br>*2 列表二<br>二级列表需要缩进一个字符</p>
</blockquote>
<h3 id="九、分割线"><a href="#九、分割线" class="headerlink" title="九、分割线"></a>九、分割线</h3><p>分割线：— 或者*** 自动出来分割线</p>
<hr>
<h3 id="十、emoji"><a href="#十、emoji" class="headerlink" title="十、emoji"></a>十、emoji</h3><p>使用 :emoji代码: 在 markdown 里添加 emoji 😲</p>
<p><a href="https://www.webfx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener">点击这里查看所有支持的 emoji 代码</a></p>
<p>❗ 部分编辑器不支持 emoji code </p>
<p>建议直接输入 emoji，<a href="https://www.emojidaquan.com" target="_blank" rel="noopener">点击这里查看并复制 emoji</a></p>
]]></content>
      <categories>
        <category>基础</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-cli4性能优化</title>
    <url>/2020/06/17/vue-cli4%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h3 id="Gzip压缩"><a href="#Gzip压缩" class="headerlink" title="Gzip压缩"></a><strong>Gzip压缩</strong></h3><p>gizp 压缩是一种 http 请求优化方式，通过减少文件体积来提高加载速度，对于用户量多的网站，开启 gizp 压缩会大大降低服务器压力，提高加载速度，降低服务器流量成本</p>
<p><strong>压缩完成示例</strong></p>
<p><img src="https://s1.ax1x.com/2020/06/17/NEaSSS.png" alt="NEaSSS.png"></p>
<blockquote>
<p>安装插件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm install compression-webpack-plugin --save-de</span><br></pre></td></tr></table></figure>


<blockquote>
<p>在vue.config.js中配置</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入compression-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> CompressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">"compression-webpack-plugin"</span>);</span><br><span class="line"><span class="comment">// 定义压缩文件类型</span></span><br><span class="line"><span class="keyword">const</span> productionGzipExtensions = [<span class="string">"js"</span>, <span class="string">"css"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//统一配置打包插件</span></span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CompressionWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">"[path].gz[query]"</span>,</span><br><span class="line">        algorithm: <span class="string">"gzip"</span>,</span><br><span class="line">        test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\.("</span> + productionGzipExtensions.join(<span class="string">"|"</span>) + <span class="string">")$"</span>), <span class="comment">//匹配文件名</span></span><br><span class="line">        threshold: <span class="number">10240</span>, <span class="comment">//对10K以上的数据进行压缩</span></span><br><span class="line">        minRatio: <span class="number">0.8</span>,</span><br><span class="line">        deleteOriginalAssets: <span class="literal">false</span>, <span class="comment">//是否删除源文件</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在服务器的 nginx的http中配置 Gzip</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gzip on; #开启或关闭gzip on off</span><br><span class="line">gzip_min_length 5k; #gzip压缩最小文件大小，超出进行压缩（自行调节）</span><br><span class="line">gzip_buffers 4 16k; #buffer 不用修改</span><br><span class="line">gzip_comp_level 4; #压缩级别:1-10，数字越大压缩的越好，时间也越长</span><br><span class="line">gzip_types text/plain application/x-javascript application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png; #  压缩文件类型</span><br><span class="line">gzip_vary on; # 和http头有关系，加个vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩，所以根据客户端的HTTP头来判断，是否需要压缩</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改后记得执行 nginx -s reload</p>
</blockquote>
<h3 id="去掉打包后的-console"><a href="#去掉打包后的-console" class="headerlink" title="去掉打包后的 console"></a><strong>去掉打包后的 console</strong></h3><blockquote>
<p>安裝插件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm install babel-plugin-transform-remove-<span class="built_in">console</span> --save-dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>【babel.config.js】配置如下</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [<span class="string">"@vue/babel-plugin-transform-vue-jsx"</span>];</span><br><span class="line"><span class="comment">// 生产环境移除console</span></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">"production"</span>) &#123;</span><br><span class="line">  plugins.push(<span class="string">"transform-remove-console"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: plugins,</span><br><span class="line">  presets: [<span class="string">"@vue/cli-plugin-babel/preset"</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>打包部署后，生产环境的 console 就全部去掉了~</p>
</blockquote>
<h3 id="图片懒加载"><a href="#图片懒加载" class="headerlink" title="图片懒加载"></a><strong>图片懒加载</strong></h3><blockquote>
<p>安装依赖</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm i vue-lazyload -S</span><br></pre></td></tr></table></figure>

<blockquote>
<p>main.js 中直接引用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueLazyload <span class="keyword">from</span> <span class="string">"vue-lazyload"</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueLazyload);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or with options</span></span><br><span class="line">Vue.use(VueLazyload, &#123;</span><br><span class="line">  <span class="comment">//预加载高度</span></span><br><span class="line">  preLoad: <span class="number">1.3</span>,</span><br><span class="line">  <span class="comment">//错误时显示的图片</span></span><br><span class="line">  error: <span class="string">"static/about111.jpg"</span>,</span><br><span class="line">  <span class="comment">//图片加载中显示的图片</span></span><br><span class="line">  loading: <span class="string">"static/img/loading.gif"</span>,</span><br><span class="line">  <span class="comment">//尝试加载次数</span></span><br><span class="line">  attempt: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在组件中使用时，将 img 标签的 src 换成 v-lazy：</p>
</blockquote>
<ol>
<li>未使用懒加载前的代码：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;li&gt;&lt;img class&#x3D;&quot;g-img1&quot; src&#x3D;&quot;static&#x2F;1.jpg&quot; alt&#x3D;&quot;&quot; &#x2F;&gt;&lt;&#x2F;li&gt;</span><br></pre></td></tr></table></figure></li>
<li>使用懒加载后的代码：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;li&gt;&lt;img class&#x3D;&quot;g-img1&quot; v-lazy&#x3D;&quot;&#39;static&#x2F;1.jpg&#39;&quot; alt&#x3D;&quot;&quot; &#x2F;&gt;&lt;&#x2F;li&gt;</span><br></pre></td></tr></table></figure>


</li>
</ol>
]]></content>
      <categories>
        <category>vue工具</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>wx支付分享</title>
    <url>/2020/06/17/wx%E6%94%AF%E4%BB%98%E5%88%86%E4%BA%AB/</url>
    <content><![CDATA[<h3 id="wx支付"><a href="#wx支付" class="headerlink" title="wx支付"></a><strong>wx支付</strong></h3><blockquote>
<p>请求后台接口获取wx需要数据</p>
</blockquote>
<p>将请求接口得来的数据存到全局变量里面 payData 。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'post'</span>, <span class="string">'/api'</span>, obj).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> data = res.data;</span><br><span class="line">      <span class="keyword">this</span>.payData = data;</span><br><span class="line">       <span class="comment">//wx判断支付环境是否可用，若环境准备好接着调用 onBridgeReady()方法                </span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> WeixinJSBridge == <span class="string">"undefined"</span>)&#123;</span><br><span class="line">             <span class="keyword">if</span>( <span class="built_in">document</span>.addEventListener )&#123;</span><br><span class="line">              <span class="built_in">document</span>.addEventListener(<span class="string">'WeixinJSBridgeReady'</span>, onBridgeReady, <span class="literal">false</span>);</span><br><span class="line">             &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.attachEvent)&#123;</span><br><span class="line">              <span class="built_in">document</span>.attachEvent(<span class="string">'WeixinJSBridgeReady'</span>, onBridgeReady);</span><br><span class="line">              <span class="built_in">document</span>.attachEvent(<span class="string">'onWeixinJSBridgeReady'</span>, onBridgeReady);</span><br><span class="line">              &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.onBridgeReady();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">     alert(e)</span><br><span class="line">     <span class="keyword">this</span>.canSubmit=<span class="literal">true</span>;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将后台返回的参数传到wx</p>
</blockquote>
<p>  调用wx支付方法，将上面请求后台接口返回的参数传给wx 。在用户支付成功后进行下一步操作。</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//微信支付</span></span><br><span class="line">          onBridgeReady() &#123;</span><br><span class="line">              <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line">              WeixinJSBridge.invoke(</span><br><span class="line">                  <span class="string">'getBrandWCPayRequest'</span>, &#123;</span><br><span class="line">                      <span class="string">"appId"</span>: <span class="keyword">this</span>.payData.appId,     <span class="comment">//公众号名称，由商户传入</span></span><br><span class="line">                      <span class="string">"timeStamp"</span>: <span class="keyword">this</span>.payData.timeStamp,         <span class="comment">//时间戳，自1970年以来的秒数</span></span><br><span class="line">                      <span class="string">"nonceStr"</span>: <span class="keyword">this</span>.payData.nonceStr, <span class="comment">//随机串</span></span><br><span class="line">                      <span class="string">"package"</span>: <span class="keyword">this</span>.payData.package,</span><br><span class="line">                      <span class="string">"signType"</span>: <span class="keyword">this</span>.payData.signType,         <span class="comment">//微信签名方式：</span></span><br><span class="line">                      <span class="string">"paySign"</span>: <span class="keyword">this</span>.payData.paySign <span class="comment">//微信签名</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                      <span class="keyword">if</span> (res.err_msg == <span class="string">"get_brand_wcpay_request:ok"</span>) &#123;</span><br><span class="line">                          <span class="comment">//支付成功</span></span><br><span class="line">                          <span class="built_in">window</span>.location.href=<span class="string">"/activity"</span>;</span><br><span class="line">                          </span><br><span class="line">                      &#125;<span class="keyword">else</span> <span class="keyword">if</span> (res.err_msg == <span class="string">"get_brand_wcpay_request:fail"</span>) &#123;</span><br><span class="line">                          <span class="comment">// 使用以上方式判断前端返回,微信团队郑重提示：</span></span><br><span class="line">                          <span class="comment">//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span></span><br><span class="line">                          alert(res.err_msg);</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;);</span><br><span class="line">          &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="wx分享"><a href="#wx分享" class="headerlink" title="wx分享"></a><strong>wx分享</strong></h3><blockquote>
<p>jquery引入标签</p>
</blockquote>
<p>还需要引入  jweixin-1.4.0.js  文件。此文件在E盘“引用的文件”js文件中。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--微信分享--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/js/jweixin-1.4.0.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>vue在main.js中引入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入微信分享</span></span><br><span class="line"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">"weixin-js-sdk"</span>;</span><br><span class="line">Vue.use(wx);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在h5.js里面进行封装</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入微信分享</span></span><br><span class="line"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">"weixin-js-sdk"</span>;</span><br><span class="line"><span class="comment">//微信分享</span></span><br><span class="line"><span class="keyword">let</span> wxShareIntval;</span><br><span class="line"><span class="keyword">let</span> wxShareIntvalIndex=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> iosEdition = navigator.userAgent;</span><br><span class="line"><span class="keyword">let</span> isIphone = !!iosEdition.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//禁止微信分享</span></span><br><span class="line">    prohibitShare() &#123;</span><br><span class="line">        <span class="comment">// 禁止分享</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> WeixinJSBridge == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">document</span>.addEventListener) &#123;</span><br><span class="line">                    <span class="built_in">document</span>.addEventListener(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady(), <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.attachEvent) &#123;</span><br><span class="line">                    <span class="built_in">document</span>.attachEvent(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady());</span><br><span class="line">                    <span class="built_in">document</span>.attachEvent(<span class="string">'onWeixinJSBridgeReady'</span>, <span class="keyword">this</span>.onBridgeReady());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.onBridgeReady();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(e)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//初始化时屏蔽分享按钮防止点击</span></span><br><span class="line">    onBridgeReady() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            WeixinJSBridge.call(<span class="string">'hideOptionMenu'</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//定时器，请求完数据之后才可以进行wx分享</span></span><br><span class="line">    shareTimer(shareObj) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(process.env.NODE_ENV);</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">"development"</span> || !Vue.prototype.isWechat) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// wxShareIntval = setInterval(() =&gt; &#123;</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">document</span>.readyState == <span class="string">"complete"</span>) &#123; <span class="comment">//当页面加载状态为完全结束时进入</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> WeixinJSBridge == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">document</span>.addEventListener) &#123;</span><br><span class="line">                            <span class="built_in">document</span>.addEventListener(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.getWxShare(shareObj), <span class="literal">false</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.attachEvent) &#123;</span><br><span class="line">                            <span class="built_in">document</span>.attachEvent(<span class="string">'WeixinJSBridgeReady'</span>, <span class="keyword">this</span>.getWxShare(shareObj));</span><br><span class="line">                            <span class="built_in">document</span>.attachEvent(<span class="string">'onWeixinJSBridgeReady'</span>, <span class="keyword">this</span>.getWxShare(shareObj));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//微信分享配置</span></span><br><span class="line">                        <span class="keyword">this</span>.getWxShare(shareObj);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// wxShareIntvalIndex++;</span></span><br><span class="line">            <span class="comment">// if (wxShareIntvalIndex &gt; 10) &#123;</span></span><br><span class="line">            <span class="comment">//     clearInterval(wxShareIntval);</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// &#125;, 500)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getWxShare(shareObj) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> href = location.href.split(<span class="string">'#'</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (!isIphone) &#123;</span><br><span class="line">                href = location.href.split(<span class="string">'#'</span>)[<span class="number">0</span>].split(<span class="string">'?from'</span>)[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> obj = &#123;</span><br><span class="line">                url: href</span><br><span class="line">            &#125;</span><br><span class="line">            Vue.prototype.$http.get(<span class="string">'/api/user/wx/share'</span>, obj,<span class="string">'hideLoad'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> data = res.data;</span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.wxShare(data, shareObj);</span><br><span class="line">                &#125;, <span class="number">500</span>)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    wxShare(data, shareObj) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wx.config(&#123;</span><br><span class="line">                debug: <span class="literal">false</span>,</span><br><span class="line">                appId: data.data.appId, <span class="comment">// 和获取Ticke的必须一样------必填，公众号的唯一标识</span></span><br><span class="line">                timestamp: data.data.timestamp, <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">                nonceStr: data.data.nonceStr, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">                signature: data.data.signature, <span class="comment">// 必填，签名，见附录1</span></span><br><span class="line">                <span class="comment">//需要分享的列表项:发送给朋友，分享到朋友圈</span></span><br><span class="line">                jsApiList: [<span class="string">"updateTimelineShareData"</span>, <span class="string">"updateAppMessageShareData"</span>, <span class="string">"onMenuShareTimeline"</span>, <span class="string">"onMenuShareAppMessage"</span>, <span class="string">'checkJsApi'</span>, <span class="string">'openLocation'</span>, <span class="string">'getLocation'</span>]</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//处理验证失败的信息</span></span><br><span class="line">            wx.error(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// alert(JSON.stringify(res));</span></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// // //微信分享配置</span></span><br><span class="line">            <span class="comment">// if (isIphone) &#123;</span></span><br><span class="line">            <span class="comment">//     shareObj.share_url = encodeURI(shareObj.share_url)</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">//微信分享配置</span></span><br><span class="line">            history.replaceState(&#123;&#125;, shareObj.share_title, shareObj.share_url);</span><br><span class="line">            shareObj.share_url = <span class="built_in">window</span>.location.href;</span><br><span class="line">            wx.ready(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                WeixinJSBridge.call(<span class="string">'showOptionMenu'</span>);</span><br><span class="line">                clearInterval(wxShareIntval);</span><br><span class="line">                <span class="keyword">if</span> (isIphone) &#123;</span><br><span class="line">                    <span class="comment">//分享到朋友圈</span></span><br><span class="line">                    wx.updateTimelineShareData(&#123;</span><br><span class="line">                        title: shareObj.share_title, <span class="comment">// 分享标题</span></span><br><span class="line">                        desc: shareObj.share_des, <span class="comment">// 分享描述</span></span><br><span class="line">                        link: shareObj.share_url, <span class="comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span></span><br><span class="line">                        imgUrl: shareObj.share_img, <span class="comment">// 分享图标</span></span><br><span class="line">                        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户确认分享后执行的回调函数</span></span><br><span class="line"><span class="comment">//                            showTips("成功分享朋友圈")</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        cancel: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户取消分享后执行的回调函数</span></span><br><span class="line">                            <span class="comment">// showTips("取消分享到朋友圈返回:" + res);</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">//分享给朋友</span></span><br><span class="line">                    wx.updateAppMessageShareData(&#123;</span><br><span class="line">                        title: shareObj.share_title, <span class="comment">// 分享标题</span></span><br><span class="line">                        desc: shareObj.share_des, <span class="comment">// 分享描述</span></span><br><span class="line">                        link: shareObj.share_url, <span class="comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span></span><br><span class="line">                        imgUrl: shareObj.share_img, <span class="comment">// 分享图标</span></span><br><span class="line">                        type: <span class="string">""</span>, <span class="comment">// 分享类型,music、video或link，不填默认为link</span></span><br><span class="line">                        dataUrl: <span class="string">""</span>, <span class="comment">// 如果type是music或video，则要提供数据链接，默认为空</span></span><br><span class="line">                        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户确认分享后执行的回调函数</span></span><br><span class="line"><span class="comment">//                            showTips("成功分享给朋友")</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        cancel: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户取消分享后执行的回调函数</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//分享到朋友圈</span></span><br><span class="line">                    wx.onMenuShareTimeline(&#123;</span><br><span class="line">                        title: shareObj.share_title, <span class="comment">// 分享标题</span></span><br><span class="line">                        desc: shareObj.share_des, <span class="comment">// 分享描述</span></span><br><span class="line">                        link: shareObj.share_url, <span class="comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span></span><br><span class="line">                        imgUrl: shareObj.share_img, <span class="comment">// 分享图标</span></span><br><span class="line">                        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户确认分享后执行的回调函数</span></span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        cancel: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户取消分享后执行的回调函数</span></span><br><span class="line">                            <span class="comment">// showTips("取消分享到朋友圈返回:" + res);</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">//分享给朋友</span></span><br><span class="line">                    wx.onMenuShareAppMessage(&#123;</span><br><span class="line">                        title: shareObj.share_title, <span class="comment">// 分享标题</span></span><br><span class="line">                        desc: shareObj.share_des, <span class="comment">// 分享描述</span></span><br><span class="line">                        link: shareObj.share_url, <span class="comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span></span><br><span class="line">                        imgUrl: shareObj.share_img, <span class="comment">// 分享图标</span></span><br><span class="line">                        type: <span class="string">""</span>, <span class="comment">// 分享类型,music、video或link，不填默认为link</span></span><br><span class="line">                        dataUrl: <span class="string">""</span>, <span class="comment">// 如果type是music或video，则要提供数据链接，默认为空</span></span><br><span class="line">                        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户确认分享后执行的回调函数</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        cancel: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                            <span class="comment">// 用户取消分享后执行的回调函数</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>引用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">    <span class="comment">//禁止分享</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        prohibitShare();</span><br><span class="line">        <span class="keyword">this</span>.shareWx();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        alert(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">    shareWx() &#123;</span><br><span class="line">        <span class="keyword">let</span> shareObj = &#123;</span><br><span class="line">            share_title: <span class="string">"分享标题"</span>,</span><br><span class="line">            share_des: <span class="string">"分享描述"</span>,</span><br><span class="line">            share_img: <span class="string">'分享图片'</span>,</span><br><span class="line">            share_url: <span class="string">`url`</span></span><br><span class="line">        &#125;</span><br><span class="line">        shareTimer(shareObj)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>常用工具</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
</search>
